{% load filter_model %}
<div class="index_like_form" style="margin-top: 2%">
    {% if request.session.role_name == 'administrator' %}
    <label class="input_text_head">欢迎进入◉国家资格证职业技能提升补贴乐陵杏林学校考点报名系统◉信息汇总系统</label>
    <hr> {% elif request.session.role_name == 'teacher' %}
    <label class="input_text_head">欢迎进入◉国家资格证职业技能提升补贴乐陵杏林学校考点报名系统◉负责人审核系统</label>
    <hr> {% else %}
    <table class="system_index_table">
        {% if need_login%}
        <tr style="text-align: center">
            <td colspan="2">
                <label class="input_text_warning_login" style="color: #d5ff10">您尚未登录或登录超时！请
                    <a href="/report/to_login" title="您好！请登录" style="color:
                        red">登录</a>|
                    <a href="javascript:void(0);">
                        <span class="input_text_warning_login" style="color:
                            red" onclick="register_button();">注册</span>
                    </a>
                </label>
            </td>
        </tr>
        {% else %} {% endif %}
        <tr>
            <td style="width: 19%">
                <img src="/static/image/index/baomingshouye.png" height="18%" width="100%" style="margin-top:20%;text-align: left" />
            </td>
            <td rowspan="4" style="width: 75%">
                <div class="baomingxitong" style="text-align: left;height: 50%">
                    &nbsp;
                    <br> &nbsp;
                    <br> &nbsp;
                    <br> &nbsp;
                    <br> &nbsp;
                    <br>
                    <!--                    <img src="/static/image/index/baomingxitong.png" height="5%" width="50%"-->
                    <!--                         title="欢迎进入◉国家资格证职业技能提升补贴乐陵杏林学校考点报名系统◉学员信息填报系统"/>-->
                </div>
                <div style="width: 80%;text-align: center;margin-left:
                    10%;margin-right: 10%">
                    <table>
                        <tr style="height: 20%">
                            {% if request.session.nickname %}
                            <td style="width: 20%">
                                <a href='/report/report_student_info_list/'>
                                    <img src="/static/image/index/guanliyitianbao.png" height="18%" width="100%" title="管理已填报消息" style="margin-left:5%;text-align: left" />
                                </a>
                            </td>

                            <td style="width: 18%;padding-left:3%;">
                                <table border="0" cellspacing="0" cellpadding="0" style="width: 100%">
                                    <tr>
                                        <td style="width: 56%">
                                            <img src="/static/image/index/xiaoxi01.png" height="18%" width="100%" title="消息" style="margin-right:
                                                -1%" />
                                        </td>
                                        <td style="" class="index_img_a">
                                            <a href='/report/receive/' style="margin-left: -1%;height:
                                                30%">
                                                <span style="color:
                                                    red;margin-right:
                                                    auto;margin-left:
                                                    auto;height: 50%">{{not_confirm}}</span>
                                            </a>
                                        </td>
                                    </tr>

                                </table>
                            </td>
                            <td class='' style="width: 18%;padding-left:3%;">
                                <a href='/report/reset_password/' title="修改密码">
                                    <img src="/static/image/index/xiugaimima.png" height="18%" width="100%" title="修改密码" style="text-align: left" />
                                </a>
                            </td>
                            <td style="width: 18%;;padding-left:3%;">
                                <a href="/report/message_add/" title="发送信息">
                                    <img src="/static/image/index/fasongxiaoxi.png" height="18%" width="100%" title="发送消息" style="margin-left:1%;text-align: left" />
                                </a>
                            </td>
                            {%else%} {%endif%}
                        </tr>
                    </table>
                </div>
            </td>
        </tr>
        <tr>
            <td style="height: 60%">
                <table border="0" cellspacing="0" cellpadding="0" style="margin-bottom: 25%;text-align: left;width:
                    100%;height: 100%;margin-right: auto;margin-left: auto">
                    <tr style="height: 50%">
                        <td class="index_img_span_huanying2" style="width:
                            30%;height:50%;margin-right: -1%">
                            <a href='/report/receive/'>
                                <!--                                <img src="/static/image/index/huanying2.png" height="20%"-->
                                <!--                                     width="100%"-->
                                <!--                                     title="欢迎{{ request.session.nickname }}" style="margin-right: -1%"/>-->
                            </a>
                        </td>
                        <td class="index_img_span" style="width:
                            70%;padding-left: 20%;">
                            <a href='/report/user_setting/'>
                                <span style="color: red;margin:auto;">
                                    {{request.session.nickname|get_nickname }}
                                </span>
                            </a>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        {%if no_term%} {% else %}
        <!--        <tr style="text-align: center">-->
        <!--            <td colspan="2">-->
        <!--                <label class="last_term_info_warning">报名尚未开始或未登录，请不要继续操作</label>-->
        <!--            </td>-->
        <!--        </tr>-->
        {%endif%}
    </table>
    <!--    <table class="term_table">-->
    <!--        <tbody>-->
    <!--        <tr style="margin-left: 20%">-->
    <!--            <td><label class="last_term_info_name_index">{{school_term.school_term_name}}(</label></td>-->
    <!--            <td style="float: left">-->
    <!--                <div style="color: whitesmoke">起：{{school_term.school_term_start|date:"Y-m-d"}}</div>-->
    <!--                <div style="color: whitesmoke">止：{{school_term.school_term_end|date:"Y-m-d"}}</div>-->
    <!--                &lt;!&ndash;                <label class="last_term_info_start_date_index">起：{{school_term.school_term_start|date:"Y-m-d"}}</label>&ndash;&gt;-->
    <!--                &lt;!&ndash;                <label class="last_term_info_end_date_index">止：{{school_term.school_term_end|date:"Y-m-d"}}</label>&ndash;&gt;-->
    <!--            </td>-->
    <!--            <td><label class="last_term_info_name_index">)</label></td>-->
    <!--        </tr>-->
    <!--        </tbody>-->
    <!--    </table>-->
    <table class="worker_table">
        <tbody>
            <tr>
                <td style="text-align: left">
                    <a href="/report/system_guide/">
                        <img src="/static/image/index/xitongcaozuozhinan.png" height="18%" width="100%" style="margin-top:
                            10%;text-align: left" />
                    </a>
                </td>
                <td class="worker_table_sub_td">
                    <table class="term_table">
                        <tbody>
                            <tr style="margin-left: 15%">
                                <td><label class="last_term_info_name_index">{{school_term.school_term_name}}(</label></td>
                                <td style="float: left">
                                    <div style="color: whitesmoke">起：{{school_term.school_term_start|date:"Y-m-d"}}</div>
                                    <div style="color: whitesmoke">止：{{school_term.school_term_end|date:"Y-m-d"}}</div>
                                    <!--                <label class="last_term_info_start_date_index">起：{{school_term.school_term_start|date:"Y-m-d"}}</label>-->
                                    <!--                <label class="last_term_info_end_date_index">止：{{school_term.school_term_end|date:"Y-m-d"}}</label>-->
                                </td>
                                <td><label class="last_term_info_name_index">)</label></td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
            <tr>
                <td style="text-align: left">
                    <a href="/report/introduction/">
                        <img class="" src="/static/image/index/baomingtiaojian.png" height="18%" width="100%" />
                    </a>
                </td>
                <td class="worker_table_sub_td">

                </td>
            </tr>
            <tr>
                <td style="text-align: left">
                </td>
                <td class="worker_table_sub_td">

                </td>
            </tr>
            <tr>
                <td class="index_img_span_xuanzebaokaozhiye">
                    <img src="/static/image/index/xuanzebaokaozhiye.png" height="18%" width="100%" />
                </td>
                <td class="">
                    <div id="id_report_list" class="report_list">
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="worker_table_quit">
        <tbody>
            {% if request.session.username %}
            <tr>
                <td class="index_img_span_quit">
                    <!--                <img class="button_index_top" src="/static/image/index/xuanzebaokaozhiye.png" height="18%"-->
                    <!--                     width="100%"/>-->
                </td>
                <td class="worker_table_sub_td_quit_01" style="text-align:
                    right">
                    <a href="/report/sign_out" style="width:15%;">
                        <img class="" src="/static/image/index/tuichu.png" height="15%" width="15%" />
                        <!--                    <button class="button_index_top" style="text-align: center;width: 65px"><b>退出</b></button>-->
                    </a>
                </td>
                <!--            <td class="worker_table_sub_td" style="text-align: left">-->
                <!--                <a href="/report/sign_out" style="width:15%;">-->
                <!--                    <img class="" src="/static/image/index/tuichu.png" height="15%" width="15%"/>-->
                <!--                    &lt;!&ndash;                    <button class="button_index_top" style="text-align: center;width: 65px"><b>退出</b></button>&ndash;&gt;-->
                <!--                </a>-->
                <!--            </td>-->
            </tr>
            {% else %} {% endif %}
        </tbody>
    </table>

</div>
{% endif%}

<div class="box box_index">
    <div class="regiest">
        <form action="/report/register/" id='register-form-index' method="post">
            {% csrf_token %} {{ form }}
            <table style="margin-top: 10%;margin-left: auto;margin-right:
                auto;">
                <tbody>
                    <tr>
                        <td><label style="color: honeydew; float: right;">&nbsp;&nbsp;&nbsp;&nbsp;用户名:</label></td>
                        <td><input type="text" name="username" id="username_index" value="{{username}}" required="required" placeholder="用户名" onblur="check_username_index();" onchange="check_username_index();"></td>
                        <td style="width: auto;"><span class="message-label" style="color:red;margin-left: 1%; float: left;"></span></td>
                    </tr>
                    <tr>
                        <td><label style="color: honeydew; float: right;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;昵称:</label>
                        </td>
                        <td><input type="text" name="nickname" id="nickname_index" placeholder="昵称" required="required" onblur="check_nickname_index();" onchange="check_nickname_index();"></td>
                        <td style="width: auto;"><span class="message-label" style="color:red;margin-left: 1%; float: left"></span></td>
                    </tr>
                    <tr>
                        <td><label style="color: honeydew; float: right;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;密码:</label>
                        </td>
                        <td><input type="password" name="password" id="passwordReg_index" placeholder="密码" required="required" onblur="check_password_index();" onchange="check_password_index();"></td>
                        <td style="width: auto;"><span class="message-label" style="color:red;margin-left: 1%; float: left"></span></td>
                    </tr>
                    <tr>
                        <td><label style="color: honeydew; float: right;">确认密码:</label></td>
                        <td><input type="password" id="finalPWD_index" placeholder="确认密码" required="required" onblur="check_equal_index();" onchange="check_equal_index();"></td>
                        <td style="width: auto;"><span class="message-label" style="color:red;margin-left: 1%; float: left"></span></td>
                    </tr>
                </tbody>
            </table>
            <input type='submit' style="color: hotpink;width: 15%" value='提交' class='submit_index form-button submit-teacher' />

            <input type='button' style="color: hotpink;width: 15%" value="关闭" onclick="close_button();" class='form-button close_school_term' />
        </form>
    </div>
</div>
<script type="text/javascript">
    $.ajaxSetup({
        data: {
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }
    });
    $(function() {
        report_skill();
    });

    function register_button() {
        let username = $("#username");
        username.empty();
        let passwordReg = $("#passwordReg");
        passwordReg.empty();
        let left = ($(window).width() * (1 - 0.35)) / 2; //box弹出框距离左边的额距离
        let top = ($(window).height() * (1 - 0.7)) / 2;

        if ($(window).width() < 1350) {
            if ($(window).width() < 750) {
                $(".box_nav").addClass("animated bounceIn").show().css({
                    left: left,
                    top: top,
                    width: $(window).width() * 0.75,
                    height: $(window).height() * 0.35
                });
                $(".opacity_bg").css("opacity", "0.3").show();
            } else {
                $(".box_index").addClass("animated bounceIn").show().css({
                    left: left,
                    top: top,
                    width: $(window).width() * 0.50,
                    height: $(window).height() * 0.35
                });
                $(".opacity_bg").css("opacity", "0.3").show();
            }
        } else {
            $(".box_index").addClass("animated bounceIn").show().css({
                left: left,
                top: top,
                width: $(window).width() * 0.35,
                height: $(window).height() * 0.3
            });
            $(".opacity_bg").css("opacity", "0.3").show();
        }

    }


    function close_button() {
        let left = ($(window).width() * (1 - 0.35)) / 2;
        let top = ($(window).height() * (1 - 0.7)) / 2;
        $(".box_index").show().animate({
            width: "-$(window).width()*0.35",
            height: "-$(window).height()*0.3",
            left: "-" + left + "px",
            top: "-" + top + "px"
        }, 500, function() {
            let width1 = $(window).width() * 0.35;
            let height1 = $(window).height() * 0.3;
            console.log(width1);
            $(this).css({
                width: width1,
                height: height1
            }).hide();
        });
    }

    function report_skill() {
        /**
         * 获取技能列表
         * @type {string}
         */
        let url = '/report/report_kill_info/';
        // let form_data = new FormData();
        // form_data.append("csrfmiddlewaretoken", document.getElementsByName('csrfmiddlewaretoken')[0].value);
        // form_data.append("uid", obj.id);
        $.ajax({
            url: url,
            type: 'GET',
            // data: form_data,
            data: {},
            processData: false, // tell jquery not to process the data
            contentType: false, // tell jquery not to set contentType
            success: function(data) {
                console.log(data);
                var data_json = JSON.parse(data.data);
                var tmp_uniq = [];
                var tmp_list = [];
                var tmp_skill_main_class;

                $.each(data_json, function(i, n) {
                    if (n.skill_main_class !== tmp_skill_main_class) {
                        var tmp_json = {};
                        tmp_json['skill_main_class_name'] = n.skill_main_class_name;
                        tmp_json['skill_main_class'] = n.skill_main_class;
                        tmp_json['skills'] = [];
                        tmp_list.push(tmp_json);
                        tmp_skill_main_class = n.tmp_skill_main_class;
                    }
                });
                //alert(JSON.stringify(tmp_list));
                //console.log(data_json);
                var tmp_list_uniq = [];
                $.each(tmp_list, function(i, n) {
                    if (tmp_uniq.indexOf(n.skill_main_class_name) === -1) {
                        tmp_uniq.push(n.skill_main_class_name);
                        tmp_list_uniq.push(n);
                    }
                });
                //alert(tmp_uniq);
                //alert(JSON.stringify(tmp_list_uniq));
                $.each(tmp_list_uniq, function(i, n) {
                    var skill = "<div><div style='text-align: left;float:left'><span style='color:green'>" + n.skill_main_class_name + ":</span></div><div>";
                    //$(".report_list").append("<span class ='worker_size'>" + n.skill_main_class_name + "</span><br>");
                    $.each(data_json, function(j, m) {
                        if (n.skill_main_class_name === m.skill_main_class_name) {
                            n.skills.push(m);
                            skill_str = "<button class='skill_button '> <a class ='worker_size' href='/report/worker?skill_main_class=" + m.skill_main_class + "&skill_id=" + m.skill_id + "&skill_name=" + m.skill_name +
                                "' title='" + m.skill_name + "'>" + m.skill_name + "</a></button >";
                            skill = skill + skill_str;
                        }
                    });
                    $(".report_list").append(skill + "</div><div>");
                });
                alert(JSON.stringify(tmp_list_uniq));
                //var skill = "";
                // $.each(data_json, function(i, n) {
                //  skill_str = "<button class='skill_button '> <a class ='worker_size' href='/report/worker?skill_id=" + n.skill_id + "&skill_name=" + n.skill_name +
                //"' title='" + n.skill_name + "'>" + n.skill_name + "</a></button >";
                //  skill = skill + skill_str;
                //});
                //alert(skill);
                //$(".report_list").html(skill);
            }
        });
    }
</script>